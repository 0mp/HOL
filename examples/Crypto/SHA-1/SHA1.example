app load ["word32Lib", "word8Lib", "SHA1Theory"];


(*---------------------------------------------------------------------------*)
(* Run SHA-1. It's very slow.                                                *)
(*---------------------------------------------------------------------------*)

Count.apply EVAL ``stringMD "abc"``;;
Count.apply EVAL ``stringMD "abcdef"``;;


(* load "sha1ML"; open sha1ML listML stringML;
   load "Timing"; open Timing;

  Meta.installPP numML.ppHex;

  fun SHAlist L = 
    let open word8ML
        val (w0,(w1,(w2,(w3,(w4,(w5,(w6,(w7,(w8,(w9,(w10,(w11,(w12,(w13,
            (w14,(w15,(w16,(w17,(w18,w19))))))))))))))))))) = computeMD L
        val w0' = toNum w0
        val w1' = toNum w1
        val w2' = toNum w2
        val w3' = toNum w3
        val w4' = toNum w4
        val w5' = toNum w5
        val w6' = toNum w6
        val w7' = toNum w7
        val w8' = toNum w8
        val w9' = toNum w9
        val w10' = toNum w10
        val w11' = toNum w11
        val w12' = toNum w12
        val w13' = toNum w13
        val w14' = toNum w14
        val w15' = toNum w15
        val w16' = toNum w16
        val w17' = toNum w17
        val w18' = toNum w18
        val w19' = toNum w19
    in   
     (w0',w1',w2',w3',w4',w5',w6',w7',w8',w9',
      w10',w11',w12',w13',w14',w15',w16',w17',w18',w19')
    end;

  fun SHAstring s = SHAlist (MAP char_to_w8 (EXPLODE s));

     SHAstring "abc";
     (* = (A9,99,3E,36,47,6,81,6A,BA,3E,25,71,78,50,C2,6C,9C,D0,D8,9D) *)
     SHAstring "abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq";
     (* = (84,98,3E,44,1C,3B,D2,6E,BA,AE,4A,A1,F9,51,29,E5,E5,46,70,F1) *)

  fun chars s top = 
    let val (SOME c) = Char.fromString s
        val w8 = word8ML.fromNum (ORD c)
        fun loop n acc = if n >= top then acc else loop (n+1) (w8::acc)
    in loop 0 []
    end;

   (* linear but slow *)
   time SHAlist (chars "a" 10);
   time SHAlist (chars "a" 100);
   time SHAlist (chars "a" 1000); (* 6.7 sec *)
   time SHAlist (chars "a" 10000); (* 65.6 sec *)
   time SHAlist (chars "a" 100000); (* 653.4 sec *)
   time SHAlist (chars "a" 1000000); (* 6522.27 sec *)
   (* =  (34,AA,97,3C,D4,C4,DA,A4,F6,1E,EB,2B,DB,AD,27,31,65,34,1,6F) *)

*)
