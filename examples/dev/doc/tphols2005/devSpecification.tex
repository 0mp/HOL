
The circuits generated by our compiler are specified to compute a
function defined in higher order logic using a handshaking protocol,
which  works in a similar way of a function call.  

The device interface comprises the control signals \VAR{load} and
\VAR{done}.  In order to trigger the device, a positive edge (a signal
transition from low to high) must be provided on \VAR{load}. The
termination is indicated by asserting \VAR{done}.

Figure~\ref{figDev} shows a sequence of events that illustrates a
transaction in which a handshaking device computes a function $f$
starting at a time $t$ and ending at a later time $t'$ (where time
counts cycles).

\vspace*{-6mm}

\begin{figure}[htb]
   \centerline{
      \subfigure[The device is ready.]{
         \label{figDev1}\input{dev1.eepic}\hspace*{1.5cm}}
      \subfigure[There is a positive edge on \VAR{load}.]{
         \label{figDev2}\input{dev2.eepic}\hspace*{2.7cm}}}
   \hspace*{0.4cm}
   \centerline{
      \subfigure[The device is busy.]{
         \label{figDev3}\input{dev3.eepic}\hspace*{0.1cm}}
      \subfigure[The computation terminates.]{
         \label{figDev4}\input{dev4.eepic}}\hspace*{0cm}}
      \caption{\label{figDev}A handshake protocol.}
\end{figure}

\vspace*{-6mm}


At the start of a transaction (time~$t$) the device must be outputting
\DEF{T} on $done$ (to indicate it is ready) and the environment must
be asserting \DEF{F} on $load$, i.e.~in a state such that a positive
edge on $load$ can be generated (Figure~\ref{figDev1}).  A~transaction
is initiated by asserting (at time $t{+}1$) the value \DEF{T} on
$load$, i.e.~$load$ has a positive edge at time $t{+}1$. This causes
the device to read the value, $v$ say, being input on $inp$ (at time
$t{+}1$) and to de-assert $done$ (Figure~\ref{figDev2}).  The device
then becomes insensitive to inputs (Figure~\ref{figDev3}) until
\DEF{T} is next asserted on $done$, at which time (say time $t' >
t{+}1$) the value $f(v)$ computed will be output on $out$
(Figure~\ref{figDev4}).

To specifiy the behaviour of a handshaking device,
the auxiliary predicates \DEF{Posedge} and \DEF{HoldF} are defined.
A positive edge of a signal is defined as the transition of its
value from low to high or, in our case, from \DEF{F} to \DEF{T}. 
The term \mE{\DEF{HoldF}\ (t_1,t_2)\ s} says that a
signal \VAR{s} holds a low value \DEF{F} during a half-open interval
starting at \sVAR{t}{1} to just before \sVAR{t}{2}. The formal definitions are:

\vspace*{-1mm}

\[
\begin{array}{ll}
\TURNST\ \DEF{Posedge}\ s\ t~ &      = ~ \IF{~t{=}0~}{~\DEF{F}~}{~(\NOT\hspace*{0.8mm} s(t{-}1)\ \AND\ s\ t~})\\
\TURNST\ \DEF{HoldF}\ (t_1,t_2)\ s & = ~ \forall t.\ t_1 \leq t < t_2\ \IMP\ \NOT(s\ t)
\end{array}
\]



The behaviour of the handshaking device computing a function $f$ is described by the term 
$\DEF{Dev}\ f\ \VAR{(load,inp,done,out)}$ where:
\[
\begin{array}{l}
\TURNST\ \DEF{Dev}\ f\ \VAR{(load,inp,done,out)} = \\
~~\quad     (\forall t.\ \VAR{done}\ t\ \AND\ \DEF{Posedge}\ \VAR{load}\ (t{+}1)\ \\
\phantom{~~\quad     (\forall t.~} \IMP \\
\phantom{~~\quad     (\forall t.\ ~ } \exists t'.\ t' > t{+}1\ \AND\ \DEF{HoldF}\ (t{+}1,t')\ \VAR{done}\ \AND \\
\phantom{~~\quad     (\forall t.\ ~ \exists t'.\ }  \VAR{done}\ t'\ \AND\ (\VAR{out}\ t' = f (\VAR{inp}\ (t{+}1))))\ ~  \AND \\
~~\quad (\forall t.\ \VAR{done}\ t\ \AND\ \NOT(\DEF{Posedge}\ \VAR{load}\ (t{+}1))\ \IMP  \VAR{done}\ (t{+}1)) ~\AND \\
~~\quad (\forall t.\ \NOT\VAR{done}\ t\ \IMP \exists t'.\ t' > t{+}1\ \AND \VAR{done}\ (t{+}1))\\
\end{array}
\]
The first conjunct in the right-hand side describes the context presented
in Figure~\ref{figDev}. If the device is available and a positive
edge occurs on \VAR{load}, there exists a time \VAR{t'} in future
when \VAR{done} signals its termination and the output is produced.
The value of the output at time \VAR{t'} is the result
of applying \VAR{f} to the value of the input at time $\VAR{t}{+}1$.
The signal \VAR{done} holds the value \DEF{F} during the computation.
The second conjunct specifies the situation where no call
is made on \VAR{load} and the device simply remains idle.
Finally, the last conjunct states that if the device
is busy, it will eventually finish its computation
and become idle.

The synthesis tool generates theorems ${\it{Imp}}
\Rightarrow \DEF{Dev}\ f\ \VAR{(load,inp,done,out)}$, where {\it{Imp}}
is a term representing an implementation. In the next section we
describe the various forms that {\it{Imp}} takes during synthesis.
