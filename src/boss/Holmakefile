ifdef POLY
EXTRA_CLEANS = $(TARGET)

TARGET = $(dprot $(HOLDIR)/bin/hol.state)

builder0 = $(HOLDIR)/src/num/termination/numheap

boss_deps = listTheory pred_setTheory arithmeticTheory numLib \
            pred_setLib pred_setSimps numSimps optionTheory \
            RecordType
DEPS = bossLib.uo $(patsubst %,$(dprot $(SIGOBJ)/%.uo),$(boss_deps)) \
       $(dprot $(builder0))

all: $(TARGET)

$(TARGET): $(DEPS)
	$(protect $(HOLDIR)/bin/buildheap) -o $(TARGET) -b $(builder0) $(boss_deps) bossLib

endif

UOFILES = $(patsubst %.sml,%.uo,$(wildcard *.sml))

all: selftest.exe $(UOFILES)
.PHONY: all

selftest.exe: selftest.uo bossLib.uo
	$(HOLMOSMLC) -o $@ $<

installed-unsat.txt : hol4-base-unsat.thy hol4-base-unsat.art
	opentheory install --reinstall --auto-uninstall $<
	touch $@

installed.txt : hol4-base.thy hol4-base-sat.art
	opentheory install --reinstall $<
	touch $@

hol4-base-sat-info.txt : hol4-base-sat.thy prove_base_assums.ot.art
	opentheory info --theory $< > $@

hol4-base-sat.art: hol4-base-sat.thy prove_base_assums.ot.art
	opentheory info --article -o $@ $<

ARTS =bool_defs.ot.art\
  ../marker/marker.ot.art\
  ../combin/combin.ot.art\
  ../relation/relation.ot.art\
  ../one/one.ot.art\
  ../pair/src/pair.ot.art\
  ../pair/src/poset.ot.art\
  ../sum/sum.ot.art\
  ../option/option.ot.art\
  ../HolSat/sat.ot.art\
  ../num/theories/num.ot.art\
  ../num/theories/prim_rec.ot.art\
  ../num/theories/arithmetic.ot.art\
  ../num/theories/basicSize.ot.art\
  ../num/theories/while.ot.art\
  ../num/extra_theories/numpair.ot.art\
  ../num/extra_theories/divides.ot.art\
  ../num/extra_theories/logroot.ot.art\
  ../num/extra_theories/gcd.ot.art\
  ../num/extra_theories/bit.ot.art\
  ../num/extra_theories/numeral_bit.ot.art\
  ../datatype/ind_type.ot.art\
  ../pred_set/src/pred_set.ot.art\
  ../list/src/operator.ot.art\
  ../list/src/list.ot.art\
  ../list/src/rich_list.ot.art\
  ../list/src/indexedLists.ot.art\
  ../list/src/numposrep.ot.art

hol4-base-unsat.art: hol4-base.unint.thy $(ARTS) ../opentheory/hol4.int
	opentheory info --article -o $@ $<

base-theorems.art:
	opentheory info --theorems -o $@ base

hol4-assums.art: hol4-assums.thy installed-unsat.txt
	opentheory info --skip-definitions --assumptions -o $@ $<

prove_base_assums.art : prove_base_assums.otd base-theorems.art hol4-assums.art
