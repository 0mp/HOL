<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type"
      content="text/html ; charset=UTF-8" />
<title>Release Notes for Kananaskis-5 version of HOL 4</title>
</head>

<body>
<h1>Notes on HOL 4, Kananaskis-5 release</h1>

<h2 id="contents">Contents</h2>
<ul>
  <li> <a href="#new-features">New features</a> </li>
  <li> <a href="#bugs-fixed">Bugs fixed</a> </li>
  <li> <a href="#new-theories">New theories</a> </li>
  <li> <a href="#new-tools">New tools</a> </li>
  <li> <a href="#new-examples">New examples</a> </li>
  <li> <a href="#incompatibilities">Incompatibilities</a> </li>
</ul>



<h2 id="new-features">New features:</h2>

<ul>
<li> <p> There is now a <a href="http://polyml.org">Poly/ML</a>
implementation of HOL4 available for users on platforms other than
Windows. Users should build from the same source-tree, and have
version 5.2 of Poly/ML installed.  The build process is similar.
Start with </p>
<pre>
         poly &lt; tools/smart-configure.sml
</pre>
<p> Continue with </p>
<pre>
         bin/build -expk
</pre>
<p>Most of the features of the Moscow ML implementation should work in
the Poly/ML version, but as it is still rather young, users may
encounter some rough edges.  The advantage of the Poly/ML
implementation is that it is considerably quicker than the Moscow ML
implementation. Many thanks to Scott Owens for doing most of the work
on this port.</p></li>

<li><p>Overloading can now target “syntactic patterns”, which are
terms other than just constants.  Typically a pattern will be a
lambda-abstraction.  For example, one can overload the
symbol <code>&lt;&gt;</code> (meant to represent “not equal to”) to
the term <code>(\x y. ~(x = y))</code>.  The call would be </p>
<pre>
         overload_on ("&lt;&gt;", ``\x y. ~(x = y)``)
</pre>
<p> It is then possible to write terms such
as <code>``&lt;&gt;&nbsp;a&nbsp;3``</code>.  This will actually
translate to the term <code>``~(a&nbsp;=&nbsp;3)``</code> internally.
Pretty-printing will reverse the transformation so that what was typed
will also be printed.  (One can check that the term really has been
translated as desired with calls to term destructors
like <code>dest_term</code> and <code>strip_comb</code>.)  </p>

<p>Of course, in the case of <code>&lt;&gt;</code>, one would want
this as an infix.  To do this one would use <code>set_fixity</code> as
usual.  In this case, </p>
<pre>
         set_fixity "&lt;&gt;" (Infix(NONASSOC, 450))
</pre>
<p> would be appropriate.  (See
the <a href="#incompatibilities">Incompatibilities section</a> below
on the change to the associativity of grammar level 450.)</p>

<p>Finally, overloading can be type-specific.  In this way, the
default system now overloads the ASCII <code>&lt;=&gt;</code> to
equality over the booleans, and various operators over strings (see
next item). </p>

<p>The system has syntactic patterns built-in for not-equal (as
above), iff (the <code>&lt;=&gt;</code> symbol), not-iff
(<code>&lt;=/=&gt;</code>), and not-an-element-of
(<code>NOTIN</code>).  The Unicode variants (see later item) for these
are ≠, ⇔, ⇎, and ∉. </p></li>

<li><p>The <code>:string</code> type is now an alias for <code>:char
list</code>, meaning that strings inherit all of the list operations
“for free”.  Existing string operators that are effectively duplicates
of operations on lists (like <code>STRLEN</code>
and <code>STRCAT</code>) are now type-specific overloads of the list
constants.</p>

<p>Note that this means that the <code>IMPLODE</code>
and <code>EXPLODE</code> functions are now identities, and that
theorems that used to print as </p>
<pre>
         ⊢ STRLEN s = LENGTH (EXPLODE s)
</pre>
<p> are still true, but are now looping rewrites.
(The <code>STRLEN</code> in the theorem is the same term as
the <code>LENGTH</code>, and in fact the theorem (now
called <code>STRLEN_EXPLODE_THM</code>) prints
with <code>STRLEN</code> in both positions.)</p>

<p>The <code>EXPLODE</code> and <code>IMPLODE</code> constants are
still useful if theorems are to be exported to ML, where strings are
not the same type as lists of characters.</p>
</li>

<li> <p> Types can now be numerals, as long as <code>fcpTheory</code>
(the theory of finite cartesian products) is loaded.  A numeral type
has no interesting properties except that the cardinality of its
universe has exactly the size given by the numeral.  This implies that
negative number types and the type :0 do not exist.  The
pretty-printing of numeral types can be turned off with the trace
flag <code>pp_num_types</code>. </p>

<p> This removes the need for type abbreviations <code>i32</code> and
others, and also the function <code>fcpLib.mk_index_type</code>, which
has been removed. </p></li>

<li> <p> The finite cartesian product &ldquo;array&rdquo; type can now
be written with square brackets rather than with the
infix <code>**</code> operator.  This combines well with the numeric
types above.  For example, <code>:bool[32]</code> is a type of 32
booleans, and indeed is now the type used for what had been previously
called <code>word32</code>. The pretty-printing of array types can be
turned off with the trace flag <code>pp_array_types</code>. </p>

<p> Unfortunately, because of lists, at the term level one can not
index arrays with square brackets.  Instead, we recommend the
infix <code>'</code> operator (that’s an apostrophe, ASCII character
#39).  For example, <code>array ' 3</code> is the value of the fourth
element of <code>array</code> (indexing starts at zero!)</p>
</li>

<li> <p> Errors in inductive relation definitions (made
with <code>Hol_reln</code>) are now accompanied by better location
information. </p></li>

<li> <p> Errors in quotient type definitions (made with entry-points
in <code>quotientLib</code>) are now accompanied by better
diagnostics about problems like missing respectfulness results.</p></li>

<li><p> If HOL is started in a directory with
<code>INCLUDES</code> specified in a <code>Holmakefile</code>, then
those same includes are put onto the <code>loadPath</code> that is
used interactively.  This should help interactive debugging of
multiple-directory developments.</p>

<p>If <code>Holmake</code> is run in a directory
with <code>INCLUDES</code> specified in a <code>Holmakefile</code>,
then it will call itself recursively in those directories before
working in the current directory.  This behaviour can be prevented by
using the <code>--no_prereqs</code> option on the command-line, or by
including <code>NO_PREREQS</code> as an <code>OPTION</code> in
the <code>Holmakefile</code>.</p>
</li>

<li> <p> The <code>tautLib</code> decision procedure for propositional
    logic now uses external SAT solvers (through
the <code>HolSatLib</code> code) for all but the smallest goals,
translating proofs back through the HOL kernel.</p></li>

<li> <p> In the Emacs mode: provide a new option to the
work-horse <code>M-h&nbsp;M-r</code> command: if you precede it by
hitting <code>C-u</code> twice, it will
toggle <code>quietdec</code> around what is to be pasted into the HOL
session.  This can be useful if you’re opening a whole slew of big
theories and don’t want to have to watch grammar guff scroll
by.</p></li>

<li> <p> The termination prover under <code>Define</code> is now
smarter.  It now does a better job of guessing termination relations,
using a relevance criterion to cut down the number of lexicographic
combinations that are tried.  It can handle <code>DIV</code>
and <code>MOD</code> now, through the <code>termination_simps</code>
variable, which can be added to in order to support other destructor
functions.</p>

<p> Termination proofs for functions defined recursively over words
are also supported.  The system knows about subtracting 1 and also
right-shifting. </p></li>

<li> <p> Post processing for word parsing is supported with the function:</p>
<pre>
         wordsLib.guess_word_lengths : term -> term
</pre>
<p>
When possible, word lengths are guessed for the extract and
concatenate functions.  That is, <code>``(a &gt;&lt; b) w``</code> is given
type <code>``:(a + 1 - b) word``</code> and <code>``(a: a word) @@ (b: b word)``</code> is
given type <code>``:(a + b)&nbsp;word``</code>.</p>

<p>For example:</p>
<pre>
         - val _ = Parse.post_process_term := wordsLib.guess_word_lengths;
         - ``(3 &gt;&lt; 0) a @@ (7 &gt;&lt; 4) a @@ (16 &gt;&lt; 8) a``;
         &lt;&lt;HOL message: inventing new type variable names: 'a, 'b, 'c, 'd, 'e, 'f&gt;&gt;
         &lt;&lt;HOL message: assigning word length(s): 'a &lt;- 4, 'b &lt;- 13, 'c &lt;- 17, 'e &lt;- 4 and 'f &lt;- 9&gt;&gt;
         > val it = ``(3 &gt;&lt; 0) a @@ (7 &gt;&lt; 4) a @@ (16 &gt;&lt; 8) a`` : term
</pre>
<p>
The assignment message is controlled by the trace variable
<code>"notify word length guesses"</code>.</p>
</li>

<li>
<p> <code>wordsLib</code> now supports evaluation over non-standard
word-sizes:</p>
<pre>
         - load "wordsLib";
         > val it = () : unit
         - EVAL ``123w + 321w:bool[56]``;
         > val it = |- 123w + 321w = 444w : thm
</pre>
<p>Non-standard word sizes will evaluate more slowly when first used.
However, size theorems are then added to the compset, so subsequent
evaluations will be quicker.
</p></li>

<li>
<p> HOL now supports Unicode symbols as part of its parsing and
printing.  In addition, there are now appropriate Unicode symbols,
such as ∀ and ∈ built in to the system.  To enable their printing and
parsing, you must set the trace variable <code>Unicode</code>.  If
this is done, you will see, for example</p>
<pre>
         - FORALL_DEF;
         > val it = |- $∀ = (λP. P = (λx. T)) : thm
</pre>
<p> If you turn Unicode on, and see gibberish when you print terms and
theorems, your fonts and system are not Unicode and UTF-8 compatible.
Emacs versions past 22 can be made to work, as can normal shells on
MacOS and Linux.  Currently, we don’t know how to create a pleasant
Unicode experience on Window.</p>

<p>The <code>Unicode</code> trace controls the use of Unicode symbols
that are set up as explicit alternatives for ASCII equivalents.  To
set up such an aliasing, use the function</p>
<pre>
         Unicode.unicode_version : {u:string,tmnm:string} -> unit
</pre>
<p> where the string <code>u</code> is the Unicode, and
where <code>tmnm</code> is the name of the term being aliased.  Note
that you can also alias the names of syntactic patterns (see above). </p>
<p> You are also free to use the standard grammar manipulation
functions to define pretty Unicode syntax that has no ASCII equivalent
if you wish, and this can be done whether or not
the <code>Unicode</code> trace is set.</p>
</li>

<li>
  <p> A new function <code>limit</code>:</p>
<pre>
         limit : int -> simpset -> simpset
</pre>
  <p> can be used to limit the number of rewrites a simpset applies.
  By default a simpset will allow the simplifier to apply as many
  rewrites as match, possibly going into an infinite loop thereby.
  The <code>limit</code> function puts a numeric limit on this,
  usually guaranteeing the simplifier’s termination (it will still
  loop if a user-provided conversion or decision procedure loops).</p>
</li>

</ul>

<h2 id="bugs-fixed">Bugs fixed:</h2>

<ul>
<li> <code>EVAL ``BIGUNION {}``</code> now works.</li>

<li> <p> Fixed a subtle bug in termination condition extraction,
whereby multiple <code>let</code>-bindings for a variable would
cause <code>Define</code> to be unpredictable and sometimes broken.
Now variables get renamed in order to make the definition process
succeed. </p></li>

<li> <p> <code>ASM_MESON_TAC</code> (which lives
beneath <code>PROVE_TAC</code>) now properly pays attention to the
controlling reference variable <code>max_depth</code>.</p></li>

<li><p> Fixed an error in the build process when
building <code>mlyacc</code> from sources on Windows.</p></li>

</ul>


<h2 id="new-theories">New theories:</h2>
<ul>
<li>None this time!</li>
</ul>

<h2 id="new-tools">New tools:</h2>

<ul>
<li><p>There are a number of new facilities in <code>wordsLib</code>.
The main additions are:</p>

<dl>
<dt><code>WORD_ss</code>:</dt> <dd> Does some basic simplification,
evaluation and AC rewriting
(over <code>*</code>, <code>+</code>, <code>&amp;&amp;</code>
and <code>!!</code>).  For example,
<pre>
         ``a * 3w + a``  --&gt;  ``4w * a``
</pre>
and
<pre>
         ``a &amp;&amp; 3w !! a &amp;&amp; 2w``  --&gt;  ``3w &amp;&amp; a``
</pre></dd>

<dt><code>BIT_ss</code>:</dt> <dd>For example, <code>``BIT&nbsp;n&nbsp;3``&nbsp;--&gt;&nbsp;``n&nbsp;IN&nbsp;{0;&nbsp;1}``</code></dd>

<dt><code>WORD_MUL_LSL_ss</code>:</dt>
<dd>Converts multiplications to left-shifts e.g.
  <code>``2w * a`` --> ``a&nbsp;&lt;&lt;&nbsp;1``</code></dd>

<dt><code>WORD_BIT_EQ_ss</code>:</dt>
<dd>Can be used to establish bit-wise (in)equality <i>e.g.</i>
  <code>``a &amp;&amp; ~a = 0w``&nbsp;--&gt;&nbsp;``T``</code>
Does not work with <code>*</code>, <code>+</code> <i>etc.</i></dd>

<dt><code>WORD_ARITH_EQ_ss</code>:</dt>
<dd> Can be used to establish arithmetic (in)equality <i>e.g.</i>
  <code>``~(b + 1w = b + 4294967295w:word32)`` --&gt; ``T``</code>
</dd>

<dt><code>WORD_EXTRACT_ss</code>:</dt>
<dd>
Simplification for shifts and bit extraction.
Simplifies <code>--</code>, <code>w2w</code>, <code>sw2sw</code>, <code>#>></code>, <code>@@</code> <i>etc.</i> and expresses operations
  using <code>&gt;&lt;</code>, <code>&lt;&lt;</code> and <code>!!</code>.</dd>

<dt><code>WORD_DECIDE</code>:</dt>
<dd>A decision procedure.  Will solve Boolean (bitwise) problems
  and some problems over &lt;, &lt;+ etc.</dd>
</dl>




</li>
</ul>

<h2 id="new-examples">New examples:</h2>

<ul>
<li> <p> <code>examples/hol_dpllScript.sml</code> contains a very
simplistic HOL implementation of DPLL with unit propagation, with
proofs of termination, completeness and soundness. </p> </li>

</ul>

<h2 id="incompatibilities">Incompatibilities:</h2>

<ul>

<li><p> The <code>emacs</code> mode is now found in the
  file <code>tools/hol-mode.el</code> (rather
  than <code>hol98-mode.el</code>) and all of the occurrences of the
  string <code>hol98</code> there have been replaced
  by <code>hol</code>.</p> </li>

<li> <p> The <code>muddy</code> code, and the packages that depend on it
(<code>HolBdd</code> and <code>HolCheck</code>) have moved from
the <code>src</code> directory into <code>examples</code>.  If you
wish to use any of these packages, you will now have to both build
them (see below), and then explicitly include the directories in
your <code>Holmakefile</code>s.  For example, the following line at
the top of a <code>Holmakefile</code> will give access
to <code>HolBdd</code> (and its dependency, <code>muddy</code>):</p>
<pre>
         INCLUDES = $(protect $(HOLDIR)/examples/muddy) $(protect $(HOLDIR)/examples/HolBdd)
</pre>
<p> To build these libraries: </p>
<ol>
<li> On Windows, copy <code>tools\win-binaries\muddy.so</code>
to <code>examples\muddy\muddyC</code>.  On other platforms,
type <code>make</code> in <code>examples/muddy/muddyC</code>.</li>
<li> Do <code>Holmake</code> in <code>examples/muddy</code>.</li>
<li> Do <code>Holmake</code> in <code>examples/HolBdd</code>.</li>
<li> Do <code>Holmake</code> in <code>examples/HolCheck</code>.</li>
</ol></li>

<li> <p>The <code>FIRSTN</code> and <code>BUTFIRSTN</code> constants from
the theory <code>rich_list</code> are now defined in the
theory <code>list</code>, with names <code>TAKE</code>
and <code>DROP</code>.  If you load <code>rich_listTheory</code>, then
the old names are overloaded so that parsing existing theories should
continue to work.  The change may cause pain if you have code that
expects the constants to have their old names (for a call
to <code>mk_const</code> say), or if you have variables or constants
of your own using the names <code>TAKE</code>
and <code>DROP</code>.</p>
</li>

<li> <p> The <code>SET_TO_LIST</code> constant is now defined
in <code>listTheory</code> (moved from <code>containerTheory</code>),
which now depends on the theory of sets (<code>pred_setTheory</code>).
The <code>LIST_TO_SET</code> constant is now also overloaded to the
easier-to-type name <code>set</code>.  A number of theorems about both
functions are now in <code>listTheory</code>, and because the theory
of lists depends on that of sets, so too does the standard HOL
environment loaded by <code>bossLib</code>.  All of the theorems
from <code>containerTheory</code> are still accessible in the same
place, even though they are now just copies of theorems proved
in <code>listTheory</code>.</p>

<p>If the presence of a constant called <code>set</code> causes pain
because you have used the same string as a variable name and don’t
wish to change it, the constant can be hidden, and the interference
halted, by using <code>hide</code>:</p>
<pre>
         hide "set";
</pre>
</li>

<li><p>The <code>parse_in_context</code> function (used heavily in
the <code>Q</code> structure) is now pickier about its parses.  Now
any use of a free variable in a quotation that is parsed must be
consistent with its type in the provided context.</p></li>

<li><p>The user-specified pretty-printing functions that can be added
to customise printing of terms (using <code>add_user_printer</code>),
now key off term patterns rather than types.  Previously, if a term
was of a the type specified by the user, the user’s function would be
called.  Now, if the term matches the provided pattern, the function
is called.  The old behaviour can be emulated by simply giving as the
pattern a variable of the desired type.</p>

<p>Additionally, the user’s function now gets access to a richer
context of arguments when the system printer calls it.</p>

</li>

<li> <p>Precedence level 450 in the standard term grammar is now
non-associative, and suggested as an appropriate level for binary
relations, such as <i>=</i>, <i>&lt;</i> and <i>&#8838;</i>.  The list
cons operators <code>::</code> has moved out of this level to level
490, and the ++ operator used as a shorthand for list concatenation
(<code>APPEND</code>) has moved to 480.  (This preserves their
relative positioning.)
</p></li>

</ul>




<hr />

<p> <em><a href="http://hol.sourceforge.net">HOL 4, Kananaskis-5</a></em> </p>

</body> </html>
